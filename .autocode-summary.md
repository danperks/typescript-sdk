# Auto-Generated Plain SDK

This SDK is **fully automated** - all client methods, types, and operations are generated from GraphQL definitions.

## âœ¨ What's Automated

### 1. Schema Fetching
- Automatically downloads latest schema from Plain API
- Keeps types in sync with API changes

### 2. Fragment-Based Types
- All domain objects defined as reusable GraphQL fragments
- Generates TypeScript types: `CustomerFieldsFragment`, `ThreadFieldsFragment`, etc.
- Consistent data structure across all operations

### 3. Client Method Generation
- **19 methods auto-generated** from GraphQL operations
- Type-safe with full IntelliSense support
- Auto-updates when operations change

### 4. CI/CD Integration
- Daily checks for API schema updates
- Auto-creates PRs when changes detected
- Validates generated code on every PR

## ğŸ“ Project Structure

```
src/
â”œâ”€â”€ operations/
â”‚   â”œâ”€â”€ fragments.graphql    â† Define domain objects here
â”‚   â”œâ”€â”€ queries.graphql      â† Add queries here
â”‚   â””â”€â”€ mutations.graphql    â† Add mutations here
â”œâ”€â”€ generated/               â† Auto-generated (never edit)
â”‚   â””â”€â”€ sdk.ts
â”œâ”€â”€ client.ts                â† Auto-generated methods
â””â”€â”€ index.ts

scripts/
â””â”€â”€ generate-client-methods.ts  â† Generates all client methods

.github/workflows/
â”œâ”€â”€ generate.yml             â† Daily auto-update
â””â”€â”€ ci.yml                   â† Validates PRs
```

## ğŸš€ Usage

### Add a new operation

1. **Define it** in `src/operations/queries.graphql`:
   ```graphql
   query GetCustomer($customerId: ID!) {
     customer(customerId: $customerId) {
       ...CustomerFields
     }
   }
   ```

2. **Regenerate**:
   ```bash
   npm run generate
   ```

3. **Use it** (method is auto-created):
   ```typescript
   const result = await client.getCustomer({ customerId: 'c_123' });
   ```

## ğŸ”„ Generation Pipeline

```
Plain API
    â†“
generate:schema â†’ schema.graphql
    â†“
operations/*.graphql + schema.graphql
    â†“
generate:sdk â†’ sdk.ts (types + SDK)
    â†“
generate:client â†’ client.ts (methods)
    â†“
build â†’ dist/ (CJS, ESM, types)
```

## ğŸ“Š Current Operations

**Queries (9):**
- getCustomer, getCustomerByEmail, getCustomerByExternalId
- getThread, getThreads
- getMyWorkspaces
- getUser
- getCompany, getCompanies

**Mutations (10):**
- upsertCustomer, deleteCustomer
- createThread, assignThread, unassignThread, changeThreadPriority, replyToThread
- addLabels, removeLabels
- upsertCompany

**All automatically wrapped with type-safe client methods!**

## ğŸ¯ Benefits

1. **Always in sync** - Schema updates trigger automatic PRs
2. **Type-safe** - Full TypeScript support with generated types
3. **Maintainable** - Add operations in GraphQL, methods generate automatically
4. **Consistent** - Fragments ensure uniform data structures
5. **CI-friendly** - Validates generated code on every PR

## ğŸ› ï¸ Commands

```bash
npm run generate:schema   # Fetch latest schema
npm run generate:sdk      # Generate SDK from operations
npm run generate:client   # Generate client methods
npm run generate          # Run all generation steps
npm run build            # Build distributable
```

## ğŸ“ Example

```typescript
import { PlainClient, CustomerFieldsFragment } from '@plain/sdk';

const client = new PlainClient({ apiKey: 'your-key' });

// All methods are auto-generated and type-safe
const result = await client.getCustomer({ customerId: 'c_123' });

if (result.customer) {
  // result.customer is typed as CustomerFieldsFragment
  console.log(result.customer.fullName);
  console.log(result.customer.email.email);
}
```

